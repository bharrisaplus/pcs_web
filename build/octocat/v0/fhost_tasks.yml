# yaml-language-server: $schema=https://taskfile.dev/schema.json

# Tasks are expected to be called from the project root or via the main Taskfile

version: '3'

tasks:
  # Building/Transpiling/etc
  rear-presentation:
    desc: Stlus to CSS
    cmds:
      - pnpm stylus {{.PRESENTATION_DIR}}/demo.styl -m --sourcemap-base {{.DEMO_FILE_HOST}} -o {{.DEMO_DIR}}/{{.CSS_MAIN_NAME}}
      - pnpm postcss {{.DEMO_DIR}}/{{.CSS_MAIN_NAME}} --config {{.PROJECT_DIR}} -o {{.DEMO_DIR}}/{{.CSS_MAIN_NAME}}
  rear-content:
    desc: Pug to HTML
    cmds:
      - echo {{.CONTENT_DATA}} > {{.DEMO_DIR}}/content_data_options.json
      - pnpm pug {{.CONTENT_DIR}}/demo.pug -o {{.DEMO_DIR}} -O {{.DEMO_DIR}}/content_data_options.json
      - echo "JSON options created @ {{.DEMO_DIR}}/content_data_options.json"
    vars:
      APPLE_TOUCH_ICON_URL: '{{.DEMO_FILE_HOST}}{{.APPLE_TOUCH_ICON_NAME}}'
      FAVICON_32_URL: '{{.DEMO_FILE_HOST}}{{.FAVICON_32_NAME}}'
      FAVICON_32_ALT_URL: '{{.DEMO_FILE_HOST}}{{.FAVICON_32_ALT_NAME}}'
      FAVICON_16_URL: '{{.DEMO_FILE_HOST}}{{.FAVICON_16_NAME}}'
      FAVICON_16_ALT_URL: '{{.DEMO_FILE_HOST}}{{.FAVICON_16_ALT_NAME}}'
      FAVICON_ICO_URL: '{{.DEMO_FILE_HOST}}{{.FAVICON_ICO_NAME}}'
      FAVICON_ICO_ALT_URL: '{{.DEMO_FILE_HOST}}{{.FAVICON_ICO_ALT_NAME}}'
      VENDOR_CSS_RESET_URL: '{{.DEMO_FILE_HOST}}{{.VENDOR_CSS_RESET_NAME}}'
      VENDOR_CHANCEJS_URL: '{{.DEMO_FILE_HOST}}{{.VENDOR_CHANCEJS_NAME}}'
      VENDOR_HTML2CANVAS_URL: '{{.DEMO_FILE_HOST}}{{.VENDOR_HTML2CANVAS_NAME}}'
      CSS_MAIN_URL: '{{.DEMO_FILE_HOST}}{{.CSS_MAIN_NAME}}'
      ES_MAIN_URL: '{{.DEMO_FILE_HOST}}{{.ES_MAIN_NAME}}'
      BROWSERCONFIG_URL: '{{.DEMO_FILE_HOST}}{{.BROWSERCONFIG_NAME}}'
      WEBMANIFEST_URL: '{{.DEMO_FILE_HOST}}{{.WEBMANIFEST_NAME}}'
      # Turn above variables into a json string
      CONTENT_DATA: '{\"APPLE_TOUCH_ICON_URL\": \"{{.APPLE_TOUCH_ICON_URL}}\",\"FAVICON_32_URL\": \"{{.FAVICON_32_URL}}\",\"FAVICON_32_ALT_URL\": \"{{.FAVICON_32_ALT_URL}}\",\"FAVICON_16_URL\": \"{{.FAVICON_16_URL}}\",\"FAVICON_16_ALT_URL\": \"{{.FAVICON_16_ALT_URL}}\",\"FAVICON_ICO_URL\": \"{{.FAVICON_ICO_URL}}\",\"FAVICON_ICO_ALT_URL\": \"{{.FAVICON_ICO_ALT_URL}}\",\"VENDOR_CSS_RESET_URL\": \"{{.VENDOR_CSS_RESET_URL}}\",\"VENDOR_CHANCEJS_URL\": \"{{.VENDOR_CHANCEJS_URL}}\",\"VENDOR_HTML2CANVAS_URL\": \"{{.VENDOR_HTML2CANVAS_URL}}\",\"CSS_MAIN_URL\": \"{{.CSS_MAIN_URL}}\",\"ES_MAIN_URL\": \"{{.ES_MAIN_URL}}\",\"BROWSERCONFIG_URL\": \"{{.BROWSERCONFIG_URL}}\",\"WEBMANIFEST_URL\": \"{{.WEBMANIFEST_URL}}\"}'
  rear-behavior:
    desc: JS
    cmds:
      -  pnpm rollup -c {{.PROJECT_DIR}}/rollup.config.mjs
  nit-behavior:
    desc: Keeping js/mjs consistent
    cmds:
      - pnpm eslint -c {{.PROJECT_DIR}}/eslint.config.mjs {{.BEHAVIOR_DIR}}/demo.js
  nit-presentation:
    desc: Keeping stylus/css consistent
    cmds:
      - pnpm stylelint -c {{.PROJECT_DIR}}/stylelint.config.mjs {{.PRESENTATION_DIR}}/demo.styl
  # Moving things around
  put-vendor:
    desc: Copy 3rd party scripts/stylesheets/etc
    cmds:
      - cp {{.COMMON_DIR}}/vendor/meyerweb/reset.css {{.DEMO_DIR}}/{{.VENDOR_CSS_RESET_NAME}}
      - cp {{.COMMON_DIR}}/vendor/html2canvas/html2canvas.js {{.DEMO_DIR}}/{{.VENDOR_HTML2CANVAS_NAME}}
      - cp {{.COMMON_DIR}}/vendor/html2canvas/html2canvas.js.map {{.DEMO_DIR}}/{{.VENDOR_HTML2CANVAS_NAME}}.map
      - cp {{.COMMON_DIR}}/vendor/chancejs/chance.js {{.DEMO_DIR}}/{{.VENDOR_CHANCEJS_NAME}}
      - echo "MeyerWeb-CSSReset, HTML2Canvas and ChanceJS placed with demo files"
  put-meta:
    desc: Place files for offline (pwa)
    cmds:
      - cp {{.COMMON_DIR}}/favicons/sqwiggle.ico {{.DEMO_DIR}}/{{.FAVICON_ICO_NAME}}
      - cp {{.COMMON_DIR}}/favicons/sqwiggle-alt.ico {{.DEMO_DIR}}/{{.FAVICON_ICO_ALT_NAME}}
      - cp {{.COMMON_DIR}}/favicons/sqwiggle_16.png {{.DEMO_DIR}}/{{.FAVICON_16_NAME}}
      - cp {{.COMMON_DIR}}/favicons/sqwiggle_16-alt.png {{.DEMO_DIR}}/{{.FAVICON_16_ALT_NAME}}
      - cp {{.COMMON_DIR}}/favicons/sqwiggle_32.png {{.DEMO_DIR}}/{{.FAVICON_32_NAME}}
      - cp {{.COMMON_DIR}}/favicons/sqwiggle_32-alt.png {{.DEMO_DIR}}/{{.FAVICON_32_ALT_NAME}}
      - cp {{.COMMON_DIR}}/favicons/sqwiggle_180.png {{.DEMO_DIR}}/{{.APPLE_TOUCH_ICON_NAME}}
      - cp {{.COMMON_DIR}}/favicons/sqwiggle_192.png {{.DEMO_DIR}}/{{.FAVICON_ANDROID_CHROME_192_NAME}}
      - cp {{.COMMON_DIR}}/favicons/sqwiggle_512.png {{.DEMO_DIR}}/{{.FAVICON_ANDROID_CHROME_512_NAME}}
      - cp {{.CONTENT_DIR}}/browserconfig.source.xml {{.DEMO_DIR}}/{{.BROWSERCONFIG_NAME}}
      - cp {{.CONTENT_DIR}}/webmanifest.source.json {{.DEMO_DIR}}/{{.WEBMANIFEST_NAME}}
      - echo "Favicon and Offline files placed with demo files"
  # Clean up/Tear down
  sweep-content:
    desc: Remove generated files
    cmds:
      - rm -f {{.DEMO_DIR}}/demo.html
      - rm -f {{.DEMO_DIR}}/content_data_options.json

  sweep-presentation:
    desc: Remove generated files
    cmds:
      - rm -f {{.DEMO_DIR}}/main.{css,css.map}
  sweep-behavior:
    desc: Remove generated files
    cmds:
      - rm -f {{.DEMO_DIR}}/main.{js,js.map,mjs}
  sweep-vendor:
    desc: Remove generated files
    cmds:
      - rm -f {{.DEMO_DIR}}/html2canvas.{js,js.map}
      - rm -f {{.DEMO_DIR}}/chance.{js,min.js,min.js.map}
      - rm -f {{.DEMO_DIR}}/reset.css
  sweep-meta:
    desc: Remove generated files
    cmds:
      - rm -f {{.DEMO_DIR}}/{{.FAVICON_ICO_NAME}}
      - rm -f {{.DEMO_DIR}}/{{.FAVICON_ICO_ALT_NAME}}
      - rm -f {{.DEMO_DIR}}/{{.FAVICON_16_NAME}}
      - rm -f {{.DEMO_DIR}}/{{.FAVICON_16_ALT_NAME}}
      - rm -f {{.DEMO_DIR}}/{{.FAVICON_32_NAME}}
      - rm -f {{.DEMO_DIR}}/{{.FAVICON_32_ALT_NAME}}
      - rm -f {{.DEMO_DIR}}/{{.APPLE_TOUCH_ICON_NAME}}
      - rm -f {{.DEMO_DIR}}/{{.FAVICON_ANDROID_CHROME_192_NAME}}
      - rm -f {{.DEMO_DIR}}/{{.FAVICON_ANDROID_CHROME_512_NAME}}
      - rm -f {{.DEMO_DIR}}/{{.BROWSERCONFIG_NAME}}
      - rm -f {{.DEMO_DIR}}/{{.WEBMANIFEST_NAME}}
